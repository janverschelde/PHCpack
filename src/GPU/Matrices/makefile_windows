# This makefile is for the command line version
# of the Microsoft Visual Studio Compiler on Windows 10.
# The option '-O3' is unknown and replaced by '-O2'.

# location for the code for multiple double precision
MPD=../Norms
# location for the code for monomial evaluation and differentiation
CNV=../Convolutions

# architecture flag
smflag=sm_75

# location of the command line Microsoft Visual Studio Compiler
CL="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.25.28610\bin\Hostx64\x64"

# include path for the Microsoft Visual Studio Compiler
includepath="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.25.28610\include"

# include path for the Windows Kit
winkitucrt="C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt"

# libaries of the Microsoft Visual Studio compiler
libdirvs="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.25.28610\lib\x64"

# libraries of the Windows Kits
libdirkitum="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\um\x64"
libdirkitucrt="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\ucrt\x64"

# include files of the CUDA SDK
CUDASDK="C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2"
# library folder of the CUDA SDK
CUDALIB="C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2\lib\x64"

random_numbers.obj:
	@-echo ">>> compiling double random number generators ..."
	$(CL)\cl /c -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(MPD)/random_numbers.cpp \
                 /Fo: random_numbers.obj /EHsc

random_series.obj:
	@-echo ">>> compiling double random series generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(CNV)/random_series.cpp \
                 /Fo: random_series.obj /EHsc

random_matrices.obj:
	@-echo ">>> compiling double random_matrices generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      random_matrices.cpp \
                 /Fo: random_matrices.obj /EHsc

dbl_convolutions_host.obj:
	@-echo ">>> compiling dbl_convolutions_host ..."
	$(CL)\cl /c -I$(CNV) $(CNV)/dbl_convolutions_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /Fo: dbl_convolutions_host.obj

dbl_matrices_host.obj:
	@-echo ">>> compiling dbl_matrices_host ..."
	$(CL)\cl /c -I$(CNV) dbl_matrices_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /Fo: dbl_matrices_host.obj /EHsc

dbl_matrices_kernels.obj:
	@-echo ">>> compiling dbl_matrices_kernels ..."
	nvcc -ccbin=$(CL) -arch=$(smflag) -c -O3 \
                dbl_matrices_kernels.cu \
             -o dbl_matrices_kernels.obj

dbl_vectors_testers.obj:
	@-echo ">>> compiling dbl_vectors_testers ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) dbl_vectors_testers.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl_vectors_testers.obj /EHsc

test_dbl_vectors.obj:
	@-echo ">>> compiling test_dbl_vectors ..."
	$(CL)\cl /c test_dbl_vectors.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl_vectors.obj /EHsc

test_dbl_vectors: random_numbers.obj random_series.obj \
	          random_matrices.obj dbl_convolutions_host.obj \
                  dbl_matrices_host.obj dbl_matrices_kernels.obj \
                  dbl_vectors_testers.obj test_dbl_vectors.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl_vectors.exe \
              random_numbers.obj random_series.obj random_matrices.obj \
              dbl_convolutions_host.obj dbl_matrices_host.obj \
              dbl_matrices_kernels.obj dbl_vectors_testers.obj \
              test_dbl_vectors.obj

dbl_matrices_testers.obj:
	@-echo ">>> compiling dbl_matrices_testers ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) dbl_matrices_testers.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /Fo: dbl_matrices_testers.obj /EHsc

test_dbl_matrices.obj:
	@-echo ">>> compiling test_dbl_matrices ..."
	$(CL)\cl /c test_dbl_matrices.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl_matrices.obj /EHsc

test_dbl_matrices: random_numbers.obj random_series.obj \
	           random_matrices.obj dbl_convolutions_host.obj \
                   dbl_matrices_host.obj dbl_linearization.obj \
                   dbl_matrices_testers.obj test_dbl_matrices.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl_matrices.exe \
              random_numbers.obj random_series.obj random_matrices.obj \
              dbl_convolutions_host.obj dbl_matrices_host.obj \
              dbl_linearization.obj dbl_matrices_testers.obj \
              test_dbl_matrices.obj

test_upper_jobs.obj:
	@-echo ">>> compiling test_upper_jobs ..."
	$(CL)\cl /c test_upper_jobs.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_upper_jobs.obj /EHsc

test_upper_jobs: test_upper_jobs.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_upper_jobs.exe test_upper_jobs.obj

dbl_linearization.obj:
	@-echo ">>> compiling dbl_linearization ..."
	$(CL)\cl /c dbl_linearization.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl_linearization.obj /EHsc

test_dbl_linearization.obj:
	@-echo ">>> compiling test_dbl_linearization ..."
	$(CL)\cl /c test_dbl_linearization.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl_linearization.obj /EHsc

test_dbl_linearization: test_dbl_linearization.obj dbl_linearization.obj \
                        random_numbers.obj random_series.obj \
                        random_matrices.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl_linearization.exe \
             test_dbl_linearization.obj dbl_linearization.obj \
             random_numbers.obj random_series.obj random_matrices.obj

dbl_factorizations.obj:
	@-echo ">>> compiling dbl_factorizations ..."
	$(CL)\cl /c dbl_factorizations.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl_factorizations.obj /EHsc

dbl_factors_testers.obj:
	@-echo ">>> compiling dbl_factors_testers ..."
	$(CL)\cl /c dbl_factors_testers.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl_factors_testers.obj /EHsc

test_dbl_factors.obj:
	@-echo ">>> compiling test_dbl_factors ..."
	$(CL)\cl /c test_dbl_factors.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl_factors.obj /EHsc

test_dbl_factors: test_dbl_factors.obj dbl_factorizations.obj \
                  random_numbers.obj random_series.obj \
                  random_matrices.obj dbl_factors_testers.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl_factors.exe \
             test_dbl_factors.obj dbl_factorizations.obj \
	     dbl_factors_testers.obj \
             random_numbers.obj random_series.obj random_matrices.obj

dbl_tabs_host.obj:
	@-echo ">>> compiling dbl_tabs_host ..."
	$(CL)\cl /c dbl_tabs_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl_tabs_host.obj /EHsc

dbl_tabs_kernels.obj:
	@-echo ">>> compiling dbl_tabs_kernels ..."
	nvcc -ccbin=$(CL) -arch=$(smflag) -c -O3 \
                dbl_tabs_kernels.cu \
             -o dbl_tabs_kernels.obj

dbl_tabs_testers.obj:
	@-echo ">>> compiling dbl_tabs_testers ..."
	$(CL)\cl /c dbl_tabs_testers.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl_tabs_testers.obj /EHsc

test_dbl_tabs.obj:
	@-echo ">>> compiling test_dbl_tabs ..."
	$(CL)\cl /c test_dbl_tabs.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl_tabs.obj /EHsc

test_dbl_tabs: test_dbl_tabs.obj dbl_tabs_testers.obj \
	       dbl_tabs_host.obj dbl_tabs_kernels.obj dbl_factorizations.obj \
               dbl_convolutions_host.obj dbl_matrices_host.obj \
               random_numbers.obj random_series.obj random_matrices.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl_tabs.exe \
             test_dbl_tabs.obj dbl_tabs_testers.obj \
             dbl_tabs_host.obj dbl_tabs_kernels.obj dbl_factorizations.obj \
             dbl_convolutions_host.obj dbl_matrices_host.obj \
             random_numbers.obj random_series.obj random_matrices.obj

double_double_functions.obj:
	@-echo ">>> compiling double double functions ..."
	$(CL)\cl /c -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(MPD)/double_double_functions.cpp \
                 /Fo: double_double_functions.obj /EHsc

random2_vectors.obj:
	@-echo ">>> compiling double double random vector generators ..."
	$(CL)\cl /c -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(MPD)/random2_vectors.cpp \
                 /Fo: random2_vectors.obj /EHsc

random2_matrices.obj:
	@-echo ">>> compiling double double random matrix generators ..."
	$(CL)\cl /c -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                      random2_matrices.cpp \
                 /Fo: random2_matrices.obj /EHsc

dbl2_tabs_host.obj:
	@-echo ">>> compiling dbl2_tabs_host ..."
	$(CL)\cl /c dbl2_tabs_host.cpp \
                 -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl2_tabs_host.obj /EHsc

dbl2_tabs_kernels.obj:
	@-echo ">>> compiling dbl2_tabs_kernels ..."
	nvcc -ccbin=$(CL) -arch=$(smflag) -c -O3 -I$(MPD) \
             --define-macro gpufun=1 \
                dbl2_tabs_kernels.cu \
             -o dbl2_tabs_kernels.obj

dbl2_tabs_testers.obj:
	@-echo ">>> compiling dbl2_tabs_testers ..."
	$(CL)\cl /c dbl2_tabs_testers.cpp \
                 -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl2_tabs_testers.obj /EHsc

test_dbl2_tabs.obj:
	@-echo ">>> compiling test_dbl2_tabs ..."
	$(CL)\cl /c test_dbl2_tabs.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl2_tabs.obj /EHsc

test_dbl2_tabs: test_dbl2_tabs.obj dbl2_tabs_testers.obj \
                double_double_functions.obj dbl2_tabs_host.obj \
		dbl2_tabs_kernels.obj \
                random_numbers.obj random2_vectors.obj random2_matrices.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl2_tabs.exe \
             test_dbl2_tabs.obj dbl2_tabs_testers.obj \
             dbl2_tabs_host.obj double_double_functions.obj \
	     dbl2_tabs_kernels.obj \
             random_numbers.obj random2_vectors.obj random2_matrices.obj

clean:
	del *~
	del test_dbl_vectors.obj test_dbl_vectors_lib
	del test_dbl_vectors.exe test_dbl_vectors.exp
	del test_dbl_matrices.obj test_dbl_matrices_lib
	del test_dbl_matrices.exe test_dbl_matrices.exp
	del test_upper_jobs.obj test_upper_jobs_lib
	del test_upper_jobs.exe test_upper_jobs.exp
	del dbl_linearization.obj
	del test_dbl_linearization.obj test_dbl_linearization_lib
	del test_dbl_linearization.exe test_dbl_linearization.exp
	del dbl_factorizations.obj dbl_factors_testers.obj
	del test_dbl_factors.obj test_dbl_factors_lib
	del test_dbl_factors.exe test_dbl_factors.exp
	del random_matrices.obj
	del dbl_matrices_host.obj dbl_matrices_kernels.obj
	del dbl_matrices_testers.obj dbl_vectors_testers.obj
	del dbl_tabs_host.obj dbl_tabs_kernels.obj
	del dbl_tabs_testers.obj test_dbl_tabs.obj
	del test_dbl_tabs.obj test_dbl_tabs_lib
	del test_dbl_tabs.exe test_dbl_tabs.exp
	del double_double_functions.obj
	del random2_vectors.obj random2_matrices.obj
	del dbl2_tabs_host.obj dbl2_tabs_kernels.obj
	del dbl2_tabs_testers.obj
	del test_dbl2_tabs.obj test_dbl2_tabs_lib
	del test_dbl2_tabs.exe test_dbl2_tabs.exp

cleanall: clean
	del *exe *obj *exp *lib
